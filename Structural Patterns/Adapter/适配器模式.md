# 适配器模式

Reference：https://refactoringguru.cn/design-patterns/adapter

> 使接口不兼容的对象能够相互合作

## 实际场景对应

**场景:**  开发一款股票市场监测程序，从不同的来源去下载XML格式的股票数据，向用户呈现图表

**现状：** 整合一个第三方智能分析函数库，将获取到的XML进行读取

**问题：** 分析函数库只支持JSON格式，对于从不同来源获取的XML格式的数据无法进行读取。可以通过更改源程序来解决，但是很多时候第三方的库并不允许更改，那么分析函数库就没法使用。

## 解决方案-适配器模式

创建一个适配器（一个能够转换对象接口与其他对象之间进行交互的对象），这样将复杂的转换过程通过封装对象实现。E.g.：用一个将所有数据转换为英制单位的适配器封装运行与米和千米单位制中的对象。

适配器不仅可以转换不同格式的数据，还有助于采用不同接口的对象之间的合作，具体运作方式：

1. 适配器实现与其中一个现有对象兼容的接口
2. 现有对象可以使用该接口安全地调用适配器方法
3. 适配器方法被调用以后将以另一个对象兼容的格式和顺序将请求传递给对象

所以，创建一个双向适配器，就可以实现双向转换调用。

对于上边提到的具体场景，我们可以创建一个XML和JSON的适配器，将从不同来源获取到的XML数据通过适配器转换即可得到分析函数库想要的JSON格式的数据。

## 深入适配器结构

**对象适配器**

> 使用了构成原则，适配器实现了其中一个对象的接口，并对另一个对象进行封装。

![适配器设计模式的结构（对象适配器）](https://refactoringguru.cn/images/patterns/diagrams/adapter/structure-object-adapter.png?id=33dffbe3aece29416244)

- 服务的接口与客户端的接口互不兼容，无法直接调用
- 适配器同时与客户端和服务交互，实现客户端接口的同时封装了服务对象，适配器接受客户端通过适配器接口发起的调用，并将其转换为适用于被封装服务对象的调用
- 客户端通过接口与适配器交互即可，无需与具体的适配器类耦合。
- 向程序中添加新类型适配器是无需修改已有的代码的，这在服务类的接口被更改或者替换时很有用，无需修改客户端代码就可以创建新的适配器类。

**类适配器 **

> 使用了继承机制，适配器同时继承两个对象的接口，这种方式仅能在支持多重继承的编程语言中实现

![适配器设计模式（类适配器）](https://refactoringguru.cn/images/patterns/diagrams/adapter/structure-class-adapter.png?id=e1c60240508146ed3b98)

- 类适配器不需要封装任何对象，因为它同时继承了客户端和服务的行为，适配功能在重写的方法中完成，最后生成的适配器可替代已有的客户端类进行使用

## 适用场景

### 希望使用某个类的时候，但是接口与其他代码不兼容，可以使用适配器类

适配器模式允许你创建一个中间类，其可作为代码与遗留类、第三方类或提供怪异接口的类之间的转换器

### 需要复用一些类，他们处于同一个继承体系，并且他们又有了额外的一些共同的方法，但是这些共同的方案不是所有在这一继承体系中的子类所具有的共性

可以扩展每个子类，将缺少的功能添加到新的子类中，但是你必须在所有新子类中重复添加这些代码。

将缺失功能添加到一个适配器类中是一种优雅得多的解决方案，然后可以将缺少功能的对象封装在适配器中，从而动态地获取所需功能，如果这一点正常运作，目标类必须要有通用的接口，适配器的成员变量应当遵循该通用接口，这种方式同装饰模式相类似。

## 优缺点

**优点：**

1. 单一职责原则，你可以将接口或数据转换代码从程序主要业务逻辑中分离
2. 开闭原则，只哟啊客户端代码通过客户端接口与适配器进行交互，你就能在不修改现有客户端代码的情况下在程序中添加新类型的适配器

**缺点：** 代码整体复杂度增加，因为你需要新增一系列接口和类，有时直接更改服务类使其与其他嗲吗兼容会更简单。